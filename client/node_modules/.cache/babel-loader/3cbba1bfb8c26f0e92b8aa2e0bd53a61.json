{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/baran/Documents/baris/mern-social-media/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"C:/Users/baran/Documents/baris/mern-social-media/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/baran/Documents/baris/mern-social-media/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{GLOBALTYPES}from\"./globalTypes\";import{postDataAPI,getDataAPI}from\"../../utils/fetchData\";export var MESSAGE_TYPES={ADD_USER:\"ADD_USER\",ADD_MESSAGE:\"ADD_MESSAGE\",GET_CONVERSATIONS:\"GET_CONVERSATIONS\",GET_MESSAGES:\"GET_MESSAGES\"};export var addUser=function addUser(_ref){var user=_ref.user,message=_ref.message;return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(message.users.every(function(item){return item._id!==user._id;})){dispatch({type:MESSAGE_TYPES.ADD_USER,payload:_objectSpread(_objectSpread({},user),{},{text:'',media:[]})});}case 1:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}();};export var addMessage=function addMessage(_ref3){var msg=_ref3.msg,auth=_ref3.auth,socket=_ref3.socket;return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(dispatch){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch({type:MESSAGE_TYPES.ADD_MESSAGE,payload:msg});socket.emit('addMessage',msg);_context2.prev=2;_context2.next=5;return postDataAPI('message',msg,auth.token);case 5:_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](2);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context2.t0.response.data.msg}});case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[2,7]]);}));return function(_x2){return _ref4.apply(this,arguments);};}();};export var getConversations=function getConversations(_ref5){var auth=_ref5.auth,_ref5$page=_ref5.page,page=_ref5$page===void 0?1:_ref5$page;return/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(dispatch){var res,newArr;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return getDataAPI(\"conversations?limit=\".concat(page*9),auth.token);case 3:res=_context3.sent;newArr=[];res.data.conversations.forEach(function(item){item.recipients.forEach(function(cv){if(cv._id!==auth.user._id){newArr.push(_objectSpread(_objectSpread({},cv),{},{text:item.text,media:item.media}));}});});dispatch({type:MESSAGE_TYPES.GET_CONVERSATIONS,payload:{newArr:newArr,result:res.data.result}});_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](0);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context3.t0.response.data.msg}});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[0,9]]);}));return function(_x3){return _ref6.apply(this,arguments);};}();};export var getMessages=function getMessages(_ref7){var auth=_ref7.auth,id=_ref7.id,_ref7$page=_ref7.page,page=_ref7$page===void 0?1:_ref7$page;return/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(dispatch){var res;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return getDataAPI(\"message/\".concat(id,\"?limit=\").concat(page*9),auth.token);case 3:res=_context4.sent;dispatch({type:MESSAGE_TYPES.GET_MESSAGES,payload:res.data});_context4.next=10;break;case 7:_context4.prev=7;_context4.t0=_context4[\"catch\"](0);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context4.t0.response.data.msg}});case 10:case\"end\":return _context4.stop();}}},_callee4,null,[[0,7]]);}));return function(_x4){return _ref8.apply(this,arguments);};}();};","map":{"version":3,"names":["GLOBALTYPES","postDataAPI","getDataAPI","MESSAGE_TYPES","ADD_USER","ADD_MESSAGE","GET_CONVERSATIONS","GET_MESSAGES","addUser","user","message","dispatch","users","every","item","_id","type","payload","text","media","addMessage","msg","auth","socket","emit","token","ALERT","error","response","data","getConversations","page","res","newArr","conversations","forEach","recipients","cv","push","result","getMessages","id"],"sources":["C:/Users/baran/Documents/baris/mern-social-media/client/src/redux/actions/messageAction.js"],"sourcesContent":["import { GLOBALTYPES } from \"./globalTypes\";\r\nimport { postDataAPI, getDataAPI } from \"../../utils/fetchData\";\r\n\r\n\r\nexport const MESSAGE_TYPES = {\r\n  ADD_USER: \"ADD_USER\",\r\n  ADD_MESSAGE: \"ADD_MESSAGE\",\r\n  GET_CONVERSATIONS: \"GET_CONVERSATIONS\",\r\n  GET_MESSAGES: \"GET_MESSAGES\",\r\n};\r\n\r\nexport const addUser = ({ user, message }) => async (dispatch) => {\r\n    if(message.users.every(item => item._id !== user._id)){\r\n        dispatch({type: MESSAGE_TYPES.ADD_USER, payload: {...user, text: '', media: []} });\r\n    }\r\n};\r\n\r\nexport const addMessage = ({ msg, auth, socket }) => async (dispatch) => {\r\n\r\n  dispatch({type: MESSAGE_TYPES.ADD_MESSAGE, payload: msg});\r\n  socket.emit('addMessage', msg);\r\n\r\n  try {\r\n    await postDataAPI('message', msg, auth.token)\r\n  } catch (err) {\r\n    dispatch({ type: GLOBALTYPES.ALERT, payload: {error: err.response.data.msg } });\r\n  }\r\n}\r\n\r\nexport const getConversations = ({auth, page = 1 }) => async (dispatch) => {\r\ntry {\r\n    const res = await getDataAPI(`conversations?limit=${page * 9}`, auth.token);\r\n    let newArr = [];\r\n    res.data.conversations.forEach(item => {\r\n      item.recipients.forEach(cv => {\r\n        if(cv._id !== auth.user._id){\r\n          newArr.push({...cv, text: item.text, media: item.media});\r\n        }\r\n      })\r\n    });\r\n\r\n    dispatch({ type: MESSAGE_TYPES.GET_CONVERSATIONS, payload: {newArr, result: res.data.result} });\r\n  } catch (err) {\r\n    dispatch({ type: GLOBALTYPES.ALERT, payload: {error: err.response.data.msg } });\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\nexport const getMessages = ({ auth, id, page = 1 }) => async (dispatch) => {\r\n  try {\r\n    const res = await getDataAPI(`message/${id}?limit=${page * 9}`, auth.token);\r\n\r\n    dispatch({ type: MESSAGE_TYPES.GET_MESSAGES, payload: res.data });\r\n  } catch (err) {\r\n    dispatch({\r\n      type: GLOBALTYPES.ALERT,\r\n      payload: { error: err.response.data.msg },\r\n    });\r\n  }\r\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}