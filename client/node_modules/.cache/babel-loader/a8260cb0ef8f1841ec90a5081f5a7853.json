{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/baran/Documents/baris/mern-social-media/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/baran/Documents/baris/mern-social-media/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/baran/Documents/baris/mern-social-media/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useRef}from'react';import{useDispatch,useSelector}from'react-redux';import{useHistory,useParams}from'react-router-dom';import{GLOBALTYPES}from'../../redux/actions/globalTypes';import{addUser,getConversations}from\"../../redux/actions/messageAction\";import{getDataAPI}from'../../utils/fetchData';import UserCard from\"../UserCard\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var LeftSide=function LeftSide(){var _useSelector=useSelector(function(state){return state;}),auth=_useSelector.auth,message=_useSelector.message;var dispatch=useDispatch();var history=useHistory();var _useParams=useParams(),id=_useParams.id;var pageEnd=useRef();var _useState=useState(0),_useState2=_slicedToArray(_useState,2),page=_useState2[0],setPage=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),search=_useState4[0],setSearch=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),searchUsers=_useState6[0],setSearchUsers=_useState6[1];var handleSearch=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var res;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(search){_context.next=3;break;}return _context.abrupt(\"return\",setSearchUsers([]));case 3:_context.prev=3;_context.next=6;return getDataAPI(\"search?username=\".concat(search),auth.token);case 6:res=_context.sent;setSearchUsers(res.data.users);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](3);dispatch({type:GLOBALTYPES.ALERT,payload:{error:_context.t0.response.data.msg}});case 13:case\"end\":return _context.stop();}}},_callee,null,[[3,10]]);}));return function handleSearch(_x){return _ref.apply(this,arguments);};}();var handleAddUser=function handleAddUser(user){setSearch('');setSearchUsers([]);dispatch(addUser({user:user,message:message}));return history.push(\"/message/\".concat(user._id));};var isActive=function isActive(user){if(id===user._id)return'active';return'';};useEffect(function(){if(message.firstLoad)return;dispatch(getConversations({auth:auth}));},[dispatch,auth,message.firstLoad]);useEffect(function(){var observer=new IntersectionObserver(function(entries){if(entries[0].isIntersecting){setPage(function(p){return p+1;});}},{threshold:0.1});observer.observe(pageEnd.current);},[setPage]);useEffect(function(){if(message.resultUsers>=(page-1)*9&&page>1){dispatch(getConversations({auth:auth,page:page}));}},[message.resultUsers,page,auth,dispatch]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"form\",{className:\"message_header\",onSubmit:handleSearch,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:search,onChange:function onChange(e){return setSearch(e.target.value);},placeholder:\"search...\"}),/*#__PURE__*/_jsx(\"button\",{style:{display:\"none\"},type:\"submit\",id:\"search\",children:\"Search\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"message_chat_list\",children:[searchUsers.length!==0?/*#__PURE__*/_jsx(_Fragment,{children:searchUsers.map(function(user){return/*#__PURE__*/_jsx(\"div\",{className:\"message_user \".concat(isActive(user)),onClick:function onClick(){return handleAddUser(user);},children:/*#__PURE__*/_jsx(UserCard,{user:user})},user._id);})}):/*#__PURE__*/_jsx(_Fragment,{children:message.users.map(function(user){return/*#__PURE__*/_jsx(\"div\",{cclassName:\"message_user \".concat(isActive(user)),onClick:function onClick(){return handleAddUser(user);},children:/*#__PURE__*/_jsx(UserCard,{user:user,msg:true,children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-circle\"})})},user._id);})}),/*#__PURE__*/_jsx(\"button\",{style:{opacity:0},ref:pageEnd,children:\"Load more..\"})]})]});};export default LeftSide;","map":{"version":3,"names":["React","useState","useEffect","useRef","useDispatch","useSelector","useHistory","useParams","GLOBALTYPES","addUser","getConversations","getDataAPI","UserCard","LeftSide","state","auth","message","dispatch","history","id","pageEnd","page","setPage","search","setSearch","searchUsers","setSearchUsers","handleSearch","e","preventDefault","token","res","data","users","type","ALERT","payload","error","response","msg","handleAddUser","user","push","_id","isActive","firstLoad","observer","IntersectionObserver","entries","isIntersecting","p","threshold","observe","current","resultUsers","target","value","display","length","map","opacity"],"sources":["C:/Users/baran/Documents/baris/mern-social-media/client/src/components/message/LeftSide.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { useHistory, useParams } from 'react-router-dom';\r\nimport { GLOBALTYPES } from '../../redux/actions/globalTypes';\r\nimport { addUser, getConversations } from \"../../redux/actions/messageAction\";\r\nimport { getDataAPI } from '../../utils/fetchData';\r\nimport UserCard from \"../UserCard\";\r\n\r\nconst LeftSide = () => {\r\n    const { auth, message } = useSelector((state) => state);\r\n    const dispatch = useDispatch();\r\n    const history = useHistory();\r\n    const { id } = useParams();\r\n    const pageEnd = useRef();\r\n    const [page, setPage] = useState(0);\r\n\r\n    const [search, setSearch] = useState('');\r\n    const [searchUsers, setSearchUsers] = useState([]);\r\n\r\n    const handleSearch = async e => {\r\n        e.preventDefault();\r\n        if (!search) return setSearchUsers([]);\r\n\r\n    try {\r\n      const res = await getDataAPI(`search?username=${search}`, auth.token);\r\n      setSearchUsers(res.data.users);\r\n    } catch (err) {\r\n      dispatch({\r\n        type: GLOBALTYPES.ALERT,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n    };\r\n\r\n    const handleAddUser = (user) => {\r\n        setSearch('');\r\n        setSearchUsers([]);\r\n        dispatch(addUser({user, message}));\r\n        return history.push(`/message/${user._id}`);\r\n    };\r\n\r\n    const isActive = (user) => {\r\n      if(id === user._id) return 'active';\r\n      return '';\r\n    }\r\n\r\n    useEffect(() => {\r\n      if (message.firstLoad) return;\r\n      dispatch(getConversations({ auth }));\r\n    }, [dispatch, auth, message.firstLoad]);\r\n\r\n     useEffect(() => {\r\n       const observer = new IntersectionObserver(\r\n         (entries) => {\r\n           if (entries[0].isIntersecting) {\r\n             setPage((p) => p + 1);\r\n           }\r\n         },\r\n         {\r\n           threshold: 0.1,\r\n         }\r\n       );\r\n       observer.observe(pageEnd.current);\r\n     }, [setPage]);\r\n\r\n     useEffect(() => {\r\n       if (message.resultUsers >= (page - 1) * 9 && page > 1) {\r\n         dispatch(getConversations({ auth, page }));\r\n       }\r\n     }, [message.resultUsers, page, auth, dispatch]);\r\n\r\n    return (\r\n      <>\r\n        <form className=\"message_header\" onSubmit={handleSearch}>\r\n          <input\r\n            type=\"text\"\r\n            value={search}\r\n            onChange={(e) => setSearch(e.target.value)}\r\n            placeholder=\"search...\"\r\n          />\r\n\r\n          <button style={{ display: \"none\" }} type=\"submit\" id=\"search\">\r\n            Search\r\n          </button>\r\n        </form>\r\n\r\n        <div className=\"message_chat_list\">\r\n          {searchUsers.length !== 0 ? (\r\n            <>\r\n              {searchUsers.map((user) => (\r\n                <div\r\n                  key={user._id}\r\n                  className={`message_user ${isActive(user)}`}\r\n                  onClick={() => handleAddUser(user)}\r\n                >\r\n                  <UserCard user={user} />\r\n                </div>\r\n              ))}\r\n            </>\r\n          ) : (\r\n            <>\r\n              {message.users.map((user) => (\r\n                <div\r\n                  key={user._id}\r\n                  cclassName={`message_user ${isActive(user)}`}\r\n                  onClick={() => handleAddUser(user)}\r\n                >\r\n                  <UserCard user={user} msg={true}>\r\n                    <i className=\"fas fa-circle\" />\r\n                  </UserCard>\r\n                </div>\r\n              ))}\r\n            </>\r\n          )}\r\n\r\n          <button style={{opacity: 0}} ref={pageEnd}>Load more..</button>\r\n        </div>\r\n      </>\r\n    );\r\n}\r\n\r\nexport default LeftSide\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}