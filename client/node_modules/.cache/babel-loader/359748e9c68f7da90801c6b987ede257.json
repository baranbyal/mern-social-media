{"ast":null,"code":"import _objectSpread from\"C:/Users/baran/Documents/baris/mern-social-media/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{POST_TYPES}from\"./redux/actions/postAction\";import{ADMIN_TYPES}from\"./redux/actions/adminAction\";import{GLOBALTYPES}from\"./redux/actions/globalTypes\";import{NOTIFY_TYPES}from\"./redux/actions/notifyAction\";import{MESSAGE_TYPES}from\"./redux/actions/messageAction\";import audioTone from'./audio/pristine-609.mp3';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var spawnNotification=function spawnNotification(body,icon,url,title){var options={body:body,icon:icon};var n=new Notification(title,options);n.onclick=function(e){e.preventDefault();window.open(url,'_blank');};};var SocketClient=function SocketClient(){var _useSelector=useSelector(function(state){return state;}),auth=_useSelector.auth,socket=_useSelector.socket,notify=_useSelector.notify;var dispatch=useDispatch();var audioRef=useRef();//!connection\nuseEffect(function(){if(auth.user.role===\"user\"){socket.emit(\"joinUser\",auth.user._id);}else if(auth.user.role===\"admin\"){socket.emit(\"joinAdmin\",auth.user._id);}},[socket,auth.user.role,auth.user._id]);useEffect(function(){socket.on(\"getActiveUsersToClient\",function(totalActiveUsers){dispatch({type:ADMIN_TYPES.GET_TOTAL_ACTIVE_USERS,payload:totalActiveUsers});});return function(){return socket.off(\"getActiveUsersToClient\");};},[socket,dispatch]);//!like Post\nuseEffect(function(){socket.on(\"likeToClient\",function(newPost){dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return function(){return socket.off(\"likeToClient\");};},[socket,dispatch]);//!Unlike Post\nuseEffect(function(){socket.on(\"unLikeToClient\",function(newPost){dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return function(){return socket.off(\"unLikeToClient\");};},[socket,dispatch]);//!Comments\nuseEffect(function(){socket.on(\"createCommentToClient\",function(newPost){dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return function(){return socket.off(\"createCommentToClient\");};},[socket,dispatch]);useEffect(function(){socket.on(\"deleteCommentToClient\",function(newPost){dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return function(){return socket.off(\"deleteCommentToClient\");};},[socket,dispatch]);//!Follow\nuseEffect(function(){socket.on(\"followToClient\",function(newUser){dispatch({type:GLOBALTYPES.AUTH,payload:_objectSpread(_objectSpread({},auth),{},{user:newUser})});});return function(){return socket.off(\"followToClient\");};},[socket,dispatch,auth]);useEffect(function(){socket.on(\"unFollowToClient\",function(newUser){dispatch({type:GLOBALTYPES.AUTH,payload:_objectSpread(_objectSpread({},auth),{},{user:newUser})});});return function(){return socket.off(\"unFollowToClient\");};},[socket,dispatch,auth]);//!Notifications\nuseEffect(function(){socket.on(\"createNotifyToClient\",function(msg){dispatch({type:NOTIFY_TYPES.CREATE_NOTIFY,payload:msg});if(notify.sound){audioRef.current.play();}spawnNotification(msg.user.username+\" \"+msg.text,msg.user.avatar,msg.url,\"CAMPUS CONNECT\");});return function(){return socket.off(\"createNotifyToClient\");};},[socket,dispatch,notify.sound]);useEffect(function(){socket.on(\"removeNotifyToClient\",function(msg){dispatch({type:NOTIFY_TYPES.REMOVE_NOTIFY,payload:msg});});return function(){return socket.off(\"removeNotifyToClient\");};},[socket,dispatch]);//!Messages\nuseEffect(function(){socket.on(\"addMessageToClient\",function(msg){dispatch({type:MESSAGE_TYPES.ADD_MESSAGE,payload:msg});});return function(){return socket.off(\"addMessageToClient\");};},[]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"audio\",{controls:true,ref:audioRef,style:{display:\"none\"},children:/*#__PURE__*/_jsx(\"source\",{src:audioTone,type:\"audio/mp3\"})})});};export default SocketClient;","map":{"version":3,"names":["React","useEffect","useRef","useDispatch","useSelector","POST_TYPES","ADMIN_TYPES","GLOBALTYPES","NOTIFY_TYPES","MESSAGE_TYPES","audioTone","spawnNotification","body","icon","url","title","options","n","Notification","onclick","e","preventDefault","window","open","SocketClient","state","auth","socket","notify","dispatch","audioRef","user","role","emit","_id","on","totalActiveUsers","type","GET_TOTAL_ACTIVE_USERS","payload","off","newPost","UPDATE_POST","newUser","AUTH","msg","CREATE_NOTIFY","sound","current","play","username","text","avatar","REMOVE_NOTIFY","ADD_MESSAGE","display"],"sources":["C:/Users/baran/Documents/baris/mern-social-media/client/src/SocketClient.js"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { POST_TYPES } from \"./redux/actions/postAction\";\r\nimport { ADMIN_TYPES } from \"./redux/actions/adminAction\";\r\nimport { GLOBALTYPES } from \"./redux/actions/globalTypes\";\r\nimport { NOTIFY_TYPES } from \"./redux/actions/notifyAction\";\r\nimport { MESSAGE_TYPES } from \"./redux/actions/messageAction\";\r\n\r\nimport audioTone from './audio/pristine-609.mp3' \r\n\r\nconst spawnNotification = (body, icon, url, title) => {\r\n  let options = {\r\n    body, icon\r\n  }\r\n  let n = new Notification(title, options);\r\n  n.onclick =  e => {\r\n    e.preventDefault();\r\n    window.open(url, '_blank');\r\n  }\r\n}\r\n\r\nconst SocketClient = () => {\r\n  const { auth, socket, notify } = useSelector((state) => state);\r\n  const dispatch = useDispatch();\r\n\r\n  const audioRef = useRef();\r\n\r\n  //!connection\r\n  useEffect(() => {\r\n    if (auth.user.role === \"user\") {\r\n      socket.emit(\"joinUser\", auth.user._id);\r\n    } else if (auth.user.role === \"admin\") {\r\n      socket.emit(\"joinAdmin\", auth.user._id);\r\n    }\r\n  }, [socket, auth.user.role, auth.user._id]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"getActiveUsersToClient\", (totalActiveUsers) => {\r\n      dispatch({\r\n        type: ADMIN_TYPES.GET_TOTAL_ACTIVE_USERS,\r\n        payload: totalActiveUsers,\r\n      });\r\n    });\r\n    return () => socket.off(\"getActiveUsersToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!like Post\r\n  useEffect(() => {\r\n    socket.on(\"likeToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"likeToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Unlike Post\r\n  useEffect(() => {\r\n    socket.on(\"unLikeToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"unLikeToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Comments\r\n  useEffect(() => {\r\n    socket.on(\"createCommentToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"createCommentToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"deleteCommentToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"deleteCommentToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Follow\r\n  useEffect(() => {\r\n    socket.on(\"followToClient\", (newUser) => {\r\n      dispatch({ type: GLOBALTYPES.AUTH, payload: { ...auth, user: newUser } });\r\n    });\r\n    return () => socket.off(\"followToClient\");\r\n  }, [socket, dispatch, auth]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"unFollowToClient\", (newUser) => {\r\n      dispatch({\r\n        type: GLOBALTYPES.AUTH,\r\n        payload: { ...auth, user: newUser },\r\n      });\r\n    });\r\n    return () => socket.off(\"unFollowToClient\");\r\n  }, [socket, dispatch, auth]);\r\n\r\n  //!Notifications\r\n  useEffect(() => {\r\n    socket.on(\"createNotifyToClient\", (msg) => {\r\n      dispatch({ type: NOTIFY_TYPES.CREATE_NOTIFY, payload: msg });\r\n\r\n      if (notify.sound) {\r\n        audioRef.current.play();\r\n      }\r\n      spawnNotification(\r\n        msg.user.username + \" \" + msg.text,\r\n        msg.user.avatar,\r\n        msg.url,\r\n        \"CAMPUS CONNECT\"\r\n      );\r\n    });\r\n    return () => socket.off(\"createNotifyToClient\");\r\n  }, [socket, dispatch, notify.sound]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"removeNotifyToClient\", (msg) => {\r\n      dispatch({ type: NOTIFY_TYPES.REMOVE_NOTIFY, payload: msg });\r\n    });\r\n    return () => socket.off(\"removeNotifyToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Messages\r\n  useEffect(() => {\r\n    socket.on(\"addMessageToClient\", (msg) => {\r\n      dispatch({ type: MESSAGE_TYPES.ADD_MESSAGE, payload: msg });\r\n\r\n    });\r\n    return () => socket.off(\"addMessageToClient\");\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <audio controls ref={audioRef} style={{ display: \"none\" }}>\r\n        <source src={audioTone} type=\"audio/mp3\" />\r\n      </audio>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SocketClient;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}